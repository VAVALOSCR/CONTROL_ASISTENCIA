<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="UTF-8">
<title>UGEL 03 TNO - Izamiento</title>

<style>
body{
    font-family: Arial, Helvetica, sans-serif;
    background:#eef2f7;
    text-align:center;
    margin:0;
}
header{
    background:#003366;
    color:white;
    padding:20px;
    font-size:30px;
    font-weight:bold;
}
.caja{
    width:85%;
    margin:auto;
    background:white;
    padding:20px;
    margin-top:20px;
    border-radius:12px;
    box-shadow:0px 4px 15px rgba(0,0,0,0.15);
}
.turno{
    font-size:60px;
    color:#c40000;
    font-weight:bold;
}
.fecha{font-size:24px;}
#proximo{
    font-size:26px;
    margin-top:10px;
    color:#003366;
}
textarea{width:90%;height:120px;margin-top:10px;font-size:16px;}
input[type=password]{padding:8px;font-size:16px;}
button{
    padding:10px 20px;
    margin:10px;
    background:#003366;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
button:hover{background:#0050a0;}
.comunicado{
    background:#fff6bf;
    padding:10px;
    margin-top:10px;
    border-radius:8px;
    text-align:left;
    font-size:18px;
}
.oculto{display:none;}
.tv textarea,.tv button,.tv #login{display:none;}
.tv .turno{font-size:100px;}
.tv .fecha{font-size:40px;}
</style>

</head>

<body>

<header>UGEL 03 TNO</header>

<div class="caja">
    <div class="fecha" id="fecha">Cargando fecha...</div>
    <h2>Responsable del Izamiento de Bandera</h2>
    <div class="turno" id="turno">Calculando...</div>
    <div id="proximo"></div>
</div>

<div class="caja" id="login">
    <h2>Acceso Administrativo</h2>
    <input type="password" id="clave" placeholder="Ingrese contraseña">
    <button onclick="login()">Ingresar</button>
</div>

<div class="caja oculto" id="editor">
    <h2>Publicar Comunicado</h2>
    <textarea id="mensaje"></textarea><br>
    <button onclick="guardarComunicado()">Publicar</button>
    <button onclick="borrarComunicados()">Borrar Todo</button>
</div>

<div class="caja">
    <h2>Comunicados Institucionales</h2>
    <div id="lista"></div>
</div>

<script>

// modo TV
if(location.search.includes("tv")){
    document.body.classList.add("tv");
}

// contraseña
const PASSWORD="ugel03";

// áreas
const areas=["DIRECCION","ADMINISTRACION","AGP","AGI"];

// login
function login(){
    let c=document.getElementById("clave").value;
    if(c===PASSWORD){
        document.getElementById("editor").classList.remove("oculto");
        document.getElementById("login").classList.add("oculto");
    }else alert("Contraseña incorrecta");
}

// hora Perú
async function obtenerHoraPeru(){
    try{
        let r=await fetch("https://worldtimeapi.org/api/timezone/America/Lima",{cache:"no-store"});
        let d=await r.json();
        procesarFecha(new Date(d.datetime));
    }catch{
        let ahora=new Date(new Date().toLocaleString("en-US",{timeZone:"America/Lima"}));
        procesarFecha(ahora);
    }
}

function procesarFecha(ahora){
    let dias=["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"];
    let meses=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];

    document.getElementById("fecha").innerHTML=
    dias[ahora.getDay()]+" "+ahora.getDate()+" de "+meses[ahora.getMonth()]+" "+ahora.getFullYear()+
    " | "+ahora.toLocaleTimeString();

    calcularTurno(ahora);
}

function calcularTurno(hoy){

    // lunes actual
    let lunesActual=new Date(hoy);
    let dia=lunesActual.getDay();
    let diferencia=(dia===0?-6:1-dia);
    lunesActual.setDate(lunesActual.getDate()+diferencia);

    // lunes base donde fue DIRECCION
    let lunesBase=new Date("2026-02-16");

    let diff=lunesActual-lunesBase;
    let semanas=Math.floor(diff/(1000*60*60*24*7));
    if(semanas<0)semanas=0;

    let index=semanas%areas.length;
    document.getElementById("turno").innerHTML=areas[index];

    let siguiente=(index+1)%areas.length;
    document.getElementById("proximo").innerHTML="Próximo lunes: <b>"+areas[siguiente]+"</b>";
}

// comunicados
function guardarComunicado(){
    let t=document.getElementById("mensaje").value.trim();
    if(!t)return;
    let lista=JSON.parse(localStorage.getItem("comunicados")||"[]");
    lista.unshift(t);
    localStorage.setItem("comunicados",JSON.stringify(lista));
    document.getElementById("mensaje").value="";
    mostrarComunicados();
}

function borrarComunicados(){
    if(confirm("¿Borrar todos?")){
        localStorage.removeItem("comunicados");
        mostrarComunicados();
    }
}

function mostrarComunicados(){
    let lista=JSON.parse(localStorage.getItem("comunicados")||"[]");
    let div=document.getElementById("lista");
    div.innerHTML="";
    lista.forEach(m=>div.innerHTML+=`<div class="comunicado">${m}</div>`);
}

mostrarComunicados();
obtenerHoraPeru();
setInterval(obtenerHoraPeru,60000);

</script>

</body>
</html>
